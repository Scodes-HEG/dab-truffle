(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1507:function(e,t,r){"use strict";r.r(t);var n=r(2),o=(r(25),r(367),r(85),r(23),r(48),r(17)),l=r(34),c=r(1488),d=r.n(c),v=(r(1489),{layout:"default",components:{vSelect:d.a},data:function(){return{contracts:[],selectedContracts:[],stepReset:1,parcelles:[],selectedParcelles:[],pools:[],selectedPools:[],info:null,dabArray:[],selectedCouples:[],dabNecessary:0,numberOfRow:1,resetKey:1}},computed:{dabSelected:function(){for(var e=0,i=0;i<this.selectedContracts.length;i++)e+=Number(this.selectedContracts[i].data.dab);return e}},created:function(){this.$store.state.model.requerants.read?this.init():o.a.$on("model-initialised",function(){this.init()}.bind(this))},methods:{inputChange:function(e,t){e==this.numberOfRow&&this.numberOfRow++,t||(this.selectedCouples=this.selectedCouples.filter((function(a){return a})),this.numberOfRow=this.selectedCouples.length+1,this.resetKey++),this.computeDabNecessary()},setDabNecessary:function(e,t){this.computeDabNecessary()},computeDabNecessary:function(){for(var e=0,i=0;i<this.selectedCouples.length;i++)this.selectedCouples[i]&&this.selectedCouples[i].dab&&(e+=Number(this.selectedCouples[i].dab));this.dabNecessary=e},init:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,i,d,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.parcelles=e.$store.state.model.dab.data.remote.parcelles,e.pools=e.$store.state.model.dab.data.remote.pools,e.dabArray=e.$model.dab().getRemoteDABArray(),r=e.$store.state.web3.coinbase,t.next=6,e.$model.request_register().getRequests(r);case 6:n=t.sent,o=n.accepted,c=[],i=0;case 10:if(!(i<o.length)){t.next=18;break}return t.next=13,e.$model.request_register().readRequest(o[i]);case 13:if((d=t.sent).contracts)for(v=0;v<d.contracts.length;v++)c.push(d.contracts[v].address);case 15:i++,t.next=10;break;case 18:e.$model.requerant_contract_register().getContracts(r).then((function(t){t=(t=t.filter((function(e){var address=e.address;return-1==c.indexOf(address)}))).reverse(),e.contracts=t,e.stepReset++;for(var r=0;r<t.length;r++){var n=t[r];l.a.read(n.hash).then(function(data){data=JSON.parse(data),this.currentVue.contracts[this.j].data=data;var e=this.currentVue.$model.dab().getRemoteParcellePoolDABs(data.parcelle.uuid,data.pool.uuid);this.currentVue.contracts[this.j].data.dab=e,this.currentVue.stepReset++}.bind({currentVue:e,j:r}))}}));case 19:case"end":return t.stop()}}),t)})))()},_submit:function(e){if(e.preventDefault(),!this.info)return alert("Vous devez sélectionner un pool"),!1;this.selectedCouples=this.selectedCouples.filter((function(a){return a})),console.log(this.selectedCouples),this.$model.request_register().saveNewRequest(this.selectedContracts,this.selectedCouples,this.dabNecessary,this.info)}}}),_=r(84),component=Object(_.a)(v,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"wrapper"},[t("h2",[e._v("Déposez une nouvelle requête")]),e._v(" "),t("form",{on:{submit:e._submit}},[t("label",{attrs:{for:"contracts"}},[e._v("Mes contrats non utilisés dans des requêtes validées")]),e._v(" "),t("vSelect",{attrs:{id:"contracts",options:e.contracts,multiple:!0,label:"hash",required:""},scopedSlots:e._u([{key:"option",fn:function(option){return[t("div",{staticClass:"d-center"},[option.data?e._e():t("p",[e._v(e._s(option.hash))]),e._v(" "),option.data?t("div",[t("p",[e._v("\n              Parcelle: "),t("strong",[e._v(e._s(option.data.parcelle.id))]),e._v(" - Pool: "),t("strong",[e._v(e._s(option.data.pool.pool))])]),t("p",[e._v("Valeur DABs: "),t("strong",[e._v(e._s(option.data.dab))])]),e._v(" "),t("p",[t("pre",[e._v(e._s(option.data.info))])]),e._v(" "),t("p")]):e._e()])]}},{key:"selected-option",fn:function(option){return[option.data?e._e():t("div",{staticClass:"selected d-center"},[e._v("\n          "+e._s(option.hash)+"\n        ")]),e._v(" "),option.data?t("div",{staticClass:"selected d-center"},[t("p",[e._v("\n            Parcelle: "),t("strong",[e._v(e._s(option.data.parcelle.id))]),e._v(" - Pool: "),t("strong",[e._v(e._s(option.data.pool.pool))])]),e._v(" "),t("p",[e._v("Valeur DABs: "),t("strong",[e._v(e._s(option.data.dab))])])]):e._e()]}}]),model:{value:e.selectedContracts,callback:function(t){e.selectedContracts=t},expression:"selectedContracts"}},[t("template",{slot:"no-options"},[e._v("\n        Si vous n'en avez pas encore enregistré, veuillez "),t("router-link",{attrs:{to:"/requerants/new-contract"}},[e._v("créer un nouveau contrat")])],1)],2),e._v(" "),t("br"),e._v(" "),t("p",[e._v("DAB utilisable: "),t("strong",[e._v(e._s(e.dabSelected))])]),e._v(" "),t("h4",[e._v("Les couples Parcelles/bâtiments compris dans la requête")]),e._v(" "),t("hr"),e._v(" "),t("div",{key:e.resetKey},[e._l(e.numberOfRow,(function(r){return[t("div",{staticClass:"inline",staticStyle:{width:"50%","padding-right":"1em","margin-right":"1em","border-right":"1px solid black"}},[r<e.numberOfRow?t("label",[e._v("Couple Parcelle/Bâtiment(s)")]):e._e(),e._v(" "),r==e.numberOfRow?t("label",[e._v("Séléctionnez un nouveau couple Parcelle/Bâtiment(s)")]):e._e(),e._v(" "),t("vSelect",{attrs:{id:"dabArray",options:e.dabArray,label:"key",required:""},on:{input:function(t){return e.inputChange(r,t)}},scopedSlots:e._u([{key:"option",fn:function(option){return[t("div",{staticClass:"d-center"},[option?t("p",[e._v("\n                Parcelle: "),t("strong",[e._v(e._s(option.parcelle.id))]),e._v(" - Pool: "),t("strong",[e._v(e._s(option.pool.pool))])]):e._e()])]}},{key:"selected-option",fn:function(option){return[t("div",{staticClass:"d-center"},[option?t("p",[e._v("\n                Parcelle: "),t("strong",[e._v(e._s(option.parcelle.id))]),e._v(" - Pool: "),t("strong",[e._v(e._s(option.pool.pool))])]):e._e()])]}}],null,!0),model:{value:e.selectedCouples[r-1],callback:function(t){e.$set(e.selectedCouples,r-1,t)},expression:"selectedCouples[n - 1]"}},[t("template",{slot:"no-options"},[e._v("\n            Chargement des couples Parcelle/Pool en cours...\n          ")])],2)],1),e._v(" "),t("div",{staticClass:"inline",staticStyle:{width:"39%"}},[e.selectedCouples[r-1]?t("label",[e._v("Dab nécessaires pour cette partie: "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedCouples[r-1].dab,expression:"selectedCouples[n - 1].dab"}],attrs:{type:"number",required:"true",min:"0"},domProps:{value:e.selectedCouples[r-1].dab},on:{change:function(t){return e.setDabNecessary(r,t)},input:function(t){t.target.composing||e.$set(e.selectedCouples[r-1],"dab",t.target.value)}}})]):e._e()]),e._v(" "),t("hr")]}))],2),e._v(" "),t("br"),e._v(" "),t("p",[e._v("Dab nécessaires pour ce projet: "),t("strong",[e._v(e._s(e.dabNecessary))])]),e._v(" "),t("br"),e._v(" "),t("label",{attrs:{for:"info"}},[e._v("Entrez des informations complémentaires permettant d'analyser votre requête:")]),e._v(" "),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.info,expression:"info"}],attrs:{id:"info",required:"",placeholder:"Lien vers les plans et différentes infos"},domProps:{value:e.info},on:{input:function(t){t.target.composing||(e.info=t.target.value)}}}),e._v(" "),t("br"),e._v(" "),t("br"),e._v(" "),e.dabNecessary>0?[t("strong",[e.dabSelected>=e.dabNecessary?[t("div",{staticStyle:{color:"green"}},[e._v("Vos contrats sont suffisants pour satisfaire le besoin en dab de votre projet")])]:e._e(),e._v(" "),e.dabSelected<e.dabNecessary?[t("div",{staticStyle:{color:"red"}},[e._v("Vos contrats ne sont pas suffisants pour satisfaire le besoin en dab de votre projet, il vous faudra une dérogation de "+e._s(Math.round(100-100*e.dabSelected/e.dabNecessary))+"%")])]:e._e()],2)]:e._e(),e._v(" "),t("br"),e._v(" "),e._m(0)],2)])}),[function(){var e=this._self._c;return e("button",{attrs:{type:"submit"}},[e("i",{staticClass:"fa fa-save"}),this._v(" Déposer cette requête pour validation")])}],!1,null,null,null);t.default=component.exports}}]);