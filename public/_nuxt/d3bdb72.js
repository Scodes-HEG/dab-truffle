(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{1703:function(e,t,n){"use strict";n.r(t);n(122),n(25);var r=n(3),o=n(19),c=(n(691),n(36),n(23)),d={props:["address","account","state"],data:function(){return{loading:!0,open:!1,id:null,contracts:null,info:null,url:null,couples:[],dabTotal:0,dabNecessary:0,derogation:0}},mounted:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,i,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.id=e.address.substr(e.address.length-4),e.url=Object(c.a)(e.$store.state.web3.networkId,"/address/"+e.address),t.next=4,e.$model.request_register().readRequest(e.address);case 4:for(n=t.sent,e.couples=n.couples,e.dabNecessary=n.dabNecessary,e.contracts=n.contracts,i=0;i<e.contracts.length;i++)(data=e.contracts[i].data).dab=e.$model.dab().getRemoteParcellePoolDABs(data.parcelle.uuid,data.pool.uuid),e.dabTotal+=Number(data.dab),e.contracts[i].data=data;e.derogation=Math.round(100-100*e.dabTotal/e.dabNecessary),e.derogation<0&&(e.derogation=0),e.info=n.info,e.pools=n.pools,e.loading=!1;case 14:case"end":return t.stop()}}),t)})))()},methods:{toggle:function(){this.$modal.show("modal-"+this.id)},accept:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$model.request_register().acceptRequest(e.address);case 2:o.a.$emit("list-updated");case 3:case"end":return t.stop()}}),t)})))()},refuse:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$model.request_register().refuseRequest(e.address);case 2:o.a.$emit("list-updated");case 3:case"end":return t.stop()}}),t)})))()},pend:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$model.request_register().pendRequest(e.address);case 2:o.a.$emit("list-updated");case 3:case"end":return t.stop()}}),t)})))()}}},l=n(85),_={components:{requestTableRow:Object(l.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("tr",[n("td",[n("a",{attrs:{target:"_blank",href:e.url}},[e._v(e._s(e.id))])]),e._v(" "),n("td",[e._v(e._s(e.account.patronyme)),n("br"),e._v(" ("+e._s(e.account.email)+")")]),e._v(" "),e.loading?[n("td",[e._v("Chargement en cours...")]),e._v(" "),n("td"),e._v(" "),n("td"),e._v(" "),n("td"),e._v(" "),n("td",[e.$store.state.user.info.is_admin?e._e():[n("router-link",{attrs:{to:"/admins/request"}},[e._v("Demander à devenir admin")])]],2)]:e._e(),e._v(" "),e.loading?e._e():[n("td",[n("ul",e._l(e.couples,(function(t){return n("li",[n("strong",[e._v(e._s(t.parcelle.id))]),e._v("/"),n("strong",[e._v(e._s(t.pool.pool))]),e._v(" | "),n("strong",[e._v(e._s(t.dab))])])})),0)]),e._v(" "),n("td",[n("p",{domProps:{innerHTML:e._s(e.info)}})]),e._v(" "),n("td",[n("strong",[e._v(e._s(e.dabNecessary))])]),e._v(" "),n("td",[[n("button",{on:{click:e.toggle}},[n("i",{staticClass:"fa fa-eye"}),e._v(" Afficher")])]],2),e._v(" "),n("td",[e.$store.state.user.info.is_admin?e._e():[n("router-link",{attrs:{to:"/admins/request"}},[e._v("Demander à devenir admin")])],e._v(" "),e.$store.state.user.info.is_admin?[0==e.state?[n("button",{staticClass:"inline",on:{click:e.accept}},[n("i",{staticClass:"fa fa-check"}),e._v(" Accepter")]),e._v(" "),n("button",{staticClass:"inline",on:{click:e.refuse}},[n("i",{staticClass:"fa fa-times"}),e._v(" Refuser")])]:e._e(),e._v(" "),1==e.state?[n("button",{staticClass:"inline",on:{click:e.pend}},[n("i",{staticClass:"fa fa-question"}),e._v(" Remettre en cours...")]),e._v(" "),n("button",{staticClass:"inline",on:{click:e.refuse}},[n("i",{staticClass:"fa fa-times"}),e._v(" Refuser")])]:e._e(),e._v(" "),2==e.state?[n("button",{staticClass:"inline",on:{click:e.pend}},[n("i",{staticClass:"fa fa-question"}),e._v(" Remettre en cours...")]),e._v(" "),n("button",{staticClass:"inline",on:{click:e.accept}},[n("i",{staticClass:"fa fa-check"}),e._v(" Accepter")])]:e._e()]:e._e()],2),e._v(" "),n("modal",{attrs:{name:"modal-"+e.id,adaptive:!0,reset:!0,scrollable:!0,height:"auto"}},[n("h4",[e._v("Contrats liée à la requête")]),e._v(" "),n("ul",e._l(e.contracts,(function(t){return n("li",[e._v("\n          Parcelle "+e._s(t.data.parcelle.id)+" | Pool "+e._s(t.data.pool.pool)),n("br"),e._v(" "),n("pre",{domProps:{innerHTML:e._s(t.data.info)}}),e._v(" "),n("p",[e._v("Valeur dab: "),n("strong",[e._v(e._s(t.data.dab))])])])})),0),e._v(" "),n("h4",[e._v("Total de dab:")]),e._v(" "),n("ul",[n("li",[n("p",[n("strong",[e._v(e._s(e.dabTotal))])])])]),e._v(" "),n("h4",[e._v("Dab nécessaire:")]),e._v(" "),n("ul",[n("li",[n("p",[n("strong",[e._v(e._s(e.dabNecessary))])])])]),e._v(" "),n("h4",[e._v("Dérogation nécessaire si validation de la requète:")]),e._v(" "),n("ul",[n("li",[n("p",[n("strong",[e._v(e._s(e.derogation)+" %")])])])])])]],2)}),[],!1,null,null,null).exports},layout:"default",data:function(){return{accounts:[],pendings:[],accepteds:[],refuseds:[],initStep:1}},created:function(){this.$store.state.model.requerants.read?this.init():o.a.$on("model-initialised",function(){this.init()}.bind(this)),o.a.$on("list-updated",function(){setTimeout(function(){this.init()}.bind(this),1e3)}.bind(this))},methods:{init:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var i,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.pendings=[],e.accepteds=[],e.refuseds=[],t.next=5,e.$model.requerants().getList();case 5:for(e.accounts=t.sent,i=0;i<e.accounts.length;i++)n=e.accounts[i],e.$model.request_register().getRequests(n.address).then(function(e){for(var t=this.that,n=t.accounts[this.i],r=0;r<e.pending.length;r++)t.pendings.push({address:e.pending[r],account:n,id:e.pending[r]+"-"+Date.now()});for(var o=0;o<e.accepted.length;o++)t.accepteds.push({id:e.accepted[o]+"-"+Date.now(),account:n,address:e.accepted[o]});for(var c=0;c<e.refused.length;c++)t.refuseds.push({id:e.refused[c]+"-"+Date.now(),account:n,address:e.refused[c]});t.initStep++}.bind({i:i,that:e}));case 7:case"end":return t.stop()}}),t)})))()}}},v=Object(l.a)(_,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"wrapper"},[n("h2",[e._v("Liste des requêtes")]),e._v(" "),n("div",{key:e.initStep},[e.pendings.length>0?[n("h3",[e._v("Requêtes en cours")]),e._v(" "),n("table",[e._m(0),e._v(" "),e._l(e.pendings,(function(t){return n("requestTableRow",{key:t.id,attrs:{address:t.address,account:t.account,state:0},on:{"status-update":e.init}})}))],2)]:[n("h3",[e._v("Aucune requête en cours")])],e._v(" "),e.accepteds.length>0?[n("h3",[e._v("Requêtes acceptées")]),e._v(" "),n("table",[e._m(1),e._v(" "),e._l(e.accepteds,(function(t){return n("requestTableRow",{key:t.id,attrs:{address:t.address,account:t.account,state:1},on:{"status-update":e.init}})}))],2)]:[n("h3",[e._v("Aucune requête acceptée")])],e._v(" "),e.refuseds.length>0?[n("h3",[e._v("Requêtes refusées")]),e._v(" "),n("table",[e._m(2),e._v(" "),e._l(e.refuseds,(function(t){return n("requestTableRow",{key:t.id,attrs:{address:t.address,account:t.account,state:2},on:{"status-update":e.init}})}))],2)]:[n("h3",[e._v("Aucune requête refusée")])]],2)])}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("tr",[n("th",[e._v("#")]),e._v(" "),n("th",[e._v("Requérants")]),e._v(" "),n("th",[e._v("Parcelles/Bâtiments | DAB")]),e._v(" "),n("th",[e._v("Info fournis")]),e._v(" "),n("th",[e._v("Dab nécessaire pour le projet")]),e._v(" "),n("th",[e._v("Analyse")]),e._v(" "),n("th",[e._v("Action")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("tr",[n("th",[e._v("#")]),e._v(" "),n("th",[e._v("Requérants")]),e._v(" "),n("th",[e._v("Parcelles/Bâtiments")]),e._v(" "),n("th",[e._v("Info fournis")]),e._v(" "),n("th",[e._v("Dab nécessaire pour le projet")]),e._v(" "),n("th",[e._v("Analyse")]),e._v(" "),n("th",[e._v("Action")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("tr",[n("th",[e._v("#")]),e._v(" "),n("th",[e._v("Requérants")]),e._v(" "),n("th",[e._v("Parcelles/Bâtiments")]),e._v(" "),n("th",[e._v("Info fournis")]),e._v(" "),n("th",[e._v("Dab nécessaire pour le projet")]),e._v(" "),n("th",[e._v("Analyse")]),e._v(" "),n("th",[e._v("Action")])])}],!1,null,null,null);t.default=v.exports}}]);