(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{1686:function(e,t,o){var content=o(1688);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(121).default)("36352c98",content,!0,{sourceMap:!1})},1687:function(e,t,o){"use strict";var r=o(1686);o.n(r).a},1688:function(e,t,o){(t=o(120)(!1)).push([e.i,"table{width:100%;border-collapse:collapse}tr:nth-of-type(odd){background:#eee}th{background:#333;color:#fff;font-weight:700}td,th{padding:6px;border:1px solid #ccc;text-align:left}input[type=number],input[type=string],input[type=text]{background-color:#f6f7e8}table input[type=number]{width:4em;margin:0;padding:1px;height:1.5em}",""]),e.exports=t},1689:function(e,t,o){"use strict";o(86),o(691),o(87),o(25);var r=o(3),l=o(36),n={props:{ipfs:null,readOnly:!1,consumed:!1},data:function(){return{show:!1,model:null,parcelles:[],pools:[],parcelle_pool_dabs:{},accepteds:{}}},created:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var o,i,r,n,c,d,address,_,f,h,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.consumed){t.next=24;break}return t.next=3,e.$model.requerants().getList();case 3:o=t.sent,i=0;case 5:if(!(i<o.length)){t.next=24;break}return r=o[i],t.next=9,e.$model.request_register().getRequests(r.address);case 9:n=t.sent,c=n.accepted,d=0;case 12:if(!(d<c.length)){t.next=21;break}return address=c[d],t.next=16,e.$model.request_register().readRequest(address);case 16:for(_=t.sent,f=0;f<_.couples.length;f++)h=_.couples[f],e.accepteds[h.parcelle.id]||(e.accepteds[h.parcelle.id]={}),e.accepteds[h.parcelle.id][h.pool.pool]||(e.accepteds[h.parcelle.id][h.pool.pool]={consumedDab:0}),e.accepteds[h.parcelle.id][h.pool.pool].consumedDab+=Number(h.dab);case 18:d++,t.next=12;break;case 21:i++,t.next=5;break;case 24:return t.next=26,l.a.read(e.ipfs);case 26:v=t.sent,v=JSON.parse(v),e.model=v,e.parcelles=v.data.parcelles,e.pools=v.data.pools,e.parcelle_pool_dabs=v.data.parcelle_pool_dabs;case 32:case"end":return t.stop()}}),t)})))()},methods:{getLocalParcellePoolDABs:function(e,t){var o=0;return this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={}&&this.parcelle_pool_dabs[e]&&this.parcelle_pool_dabs[e][t]&&(o=Number(this.parcelle_pool_dabs[e][t])),o},getConsumedParcellePoolDABs:function(e,t){return this.accepteds[e]&&this.accepteds[e][t]?this.accepteds[e][t].consumedDab:0},getLocalSurfaceTotal:function(){var e=0;return this.parcelles.forEach((function(t){e+=Number(t.surface)})),e},getLocalDABs:function(){var e=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={})for(var t in this.parcelle_pool_dabs)for(var o in this.parcelle_pool_dabs[t])e+=Number(this.parcelle_pool_dabs[t][o]);return e},getLocalPoolDABs:function(e){var t=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={})for(var o in this.parcelle_pool_dabs)this.parcelle_pool_dabs[o][e]&&(t+=Number(this.parcelle_pool_dabs[o][e]));return t},getLocalParcelleDABs:function(e){var t=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={}&&this.parcelle_pool_dabs[e])for(var o in this.parcelle_pool_dabs[e])t+=Number(this.parcelle_pool_dabs[e][o]);return t},selectIt:function(){this.$emit("select")},copyIt:function(){this.$emit("copy")}}},c=(o(1687),o(85)),component=Object(c.a)(n,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("section",{staticClass:"dabTable"},[e.consumed&&!e.model?[e.model?e._e():o("p",[e._v("Veuillez patientez, calcul du tableau de consommation en cours...")])]:e._e(),e._v(" "),!e.consumed||e.model?[e.model?e._e():o("p",[e._v("Chargement...")]),e._v(" "),!e.model||e.show||e.readOnly?e._e():o("button",{on:{click:function(t){e.show=!0}}},[o("i",{staticClass:"fa fa-eye"}),e._v(" Afficher")]),e._v(" "),e.model&&e.show&&!e.readOnly?o("button",{on:{click:function(t){e.show=!1}}},[o("i",{staticClass:"fa fa-eye-slash"}),e._v(" Cacher  ")]):e._e(),e._v(" "),e.model&&(e.show||e.readOnly)?o("table",[o("tr",[o("th",{attrs:{colspan:"3"}},[e._v("Tableau de répartition des droits à bâtir")]),e._v(" "),o("th",{attrs:{colspan:e.pools.length}},[e._v("Localisation des droits à bâtir")])]),e._v(" "),o("tr",[o("th",{attrs:{rowspan:"2"}},[e._v("Parcelle N°")]),e._v(" "),e._m(0),e._v(" "),o("th",{attrs:{rowspan:"2"}},[e._v("DAB")]),e._v(" "),e._l(e.pools,(function(t,r){return o("th",{attrs:{width:100/(3+e.pools.length)+"%"}},[e._v("BAT")])}))],2),e._v(" "),o("tr",e._l(e.pools,(function(t,r){return o("th",[e._v(e._s(t.pool))])})),0),e._v(" "),e._l(e.parcelles,(function(t,r){return o("tr",[t?o("th",[e._v(e._s(t.id))]):e._e(),e._v(" "),t?o("td",[e._v(e._s(t.surface))]):e._e(),e._v(" "),t?o("th",[e._v(e._s(e.getLocalParcelleDABs(t.uuid)))]):e._e(),e._v(" "),e._l(e.pools,(function(r,l){return o("td",[e.consumed?e._e():[e._v("\n            "+e._s(e.getLocalParcellePoolDABs(t.uuid,r.uuid))+"\n          ")],e._v(" "),e.consumed?[o("strong",[e._v(e._s(e.getConsumedParcellePoolDABs(t.id,r.pool)))]),e._v(" / "+e._s(e.getLocalParcellePoolDABs(t.uuid,r.uuid))+"\n          ")]:e._e()],2)}))],2)})),e._v(" "),o("tr",[o("th",[e._v("TOTAL")]),e._v(" "),o("th",[e._v(e._s(e.getLocalSurfaceTotal()))]),e._v(" "),o("th",[e._v(e._s(e.getLocalDABs()))]),e._v(" "),e._l(e.pools,(function(t,r){return o("th",[e._v(e._s(e.getLocalPoolDABs(t.uuid)))])}))],2)],2):e._e(),e._v(" "),e.model&&e.show&&!e.readOnly?o("button",{on:{click:function(t){return e.copyIt()}}},[o("i",{staticClass:"fa fa-arrow-left"}),e._v(" Éditer le tableau de cette proposition")]):e._e(),e._v(" "),e.model&&e.show&&!e.readOnly?o("button",{on:{click:function(t){return e.selectIt()}}},[o("i",{staticClass:"fa fa-arrow-right"}),e._v(" Voter pour cette proposition")]):e._e()]:e._e()],2)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("th",{attrs:{rowspan:"2"}},[this._v("Surface"),t("br"),this._v("Parcelle"),t("br"),this._v("en ZD3")])}],!1,null,null,null);t.a=component.exports},1691:function(e,t,o){var content=o(1700);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(121).default)("4afe300f",content,!0,{sourceMap:!1})},1699:function(e,t,o){"use strict";var r=o(1691);o.n(r).a},1700:function(e,t,o){(t=o(120)(!1)).push([e.i,".proposalList ul>li{margin-bottom:2em}",""]),e.exports=t},1702:function(e,t,o){"use strict";o.r(t);o(25);var r=o(3),l=o(1689),n=o(19),c={components:{dabTable:l.a},data:function(){return{DABModel:null}},computed:{proposalList:function(){return this.DABModel.proposalIds()}},created:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.DABModel=e.$model.dab();case 1:case"end":return t.stop()}}),t)})))()},methods:{select:function(e){var t=this;return!!confirm("Êtes-vous sûr d'accepter ce tableau comme nouveau tableau de référence ? Les autres propositions ne seront plus accessible.")&&(n.a.$on("proposal-accepted",(function(){t.$router.push("table")})),this.DABModel.acceptProposal(e))},copy:function(e){var t=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!(o&&!confirm("Êtes-vous sûr de vouloir remplacer votre tableau local par ce tableau-ci ? Vos modifications locales seront écrasées."))&&this.DABModel.copyProposal(e).then((function(e){return t.$router.push("edit"),!0}))}}},d=(o(1699),o(85)),_={layout:"default",components:{proposalList:Object(d.a)(c,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("section",{staticClass:"proposalList"},[e.proposalList.length>1?o("p",[e._v("\n  La liste est ordonnée par date de proposition (la première proposition en premier)")]):e._e(),e._v(" "),o("ul",e._l(e.proposalList,(function(t,r){return o("li",[e._v("\n      Proposition "+e._s(t)+"\n      "),o("dabTable",{attrs:{ipfs:t},on:{select:function(o){return e.select(t)},copy:function(o){return e.copy(t)}}})],1)})),0)])}),[],!1,null,null,null).exports}},f=Object(d.a)(_,(function(){var e=this.$createElement,t=this._self._c||e;return this.$store.state.model.initialised?t("div",{staticClass:"wrapper"},[t("h1",[this._v("Tableau initial des DABs partagé")]),this._v(" "),t("h2",[this._v("Liste des propositions")]),this._v(" "),t("proposalList")],1):this._e()}),[],!1,null,null,null);t.default=f.exports}}]);