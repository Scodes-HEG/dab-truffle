(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{1482:function(e,t,o){var content=o(1484);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(117).default)("d4422b1c",content,!0,{sourceMap:!1})},1483:function(e,t,o){"use strict";o(1482)},1484:function(e,t,o){var r=o(116)((function(i){return i[1]}));r.push([e.i,"table{border-collapse:collapse;width:100%}tr:nth-of-type(odd){background:#eee}th{background:#333;color:#fff;font-weight:700}td,th{border:1px solid #ccc;padding:6px;text-align:left}input[type=number],input[type=string],input[type=text]{background-color:#f6f7e8}table input[type=number]{height:1.5em;margin:0;padding:1px;width:4em}",""]),r.locals={},e.exports=r},1485:function(e,t,o){"use strict";var r=o(2),l=(o(25),o(367),o(48),o(23),o(64),o(34)),n={props:{ipfs:null,readOnly:!1,consumed:!1},data:function(){return{show:!1,model:null,parcelles:[],pools:[],parcelle_pool_dabs:{},accepteds:{}}},created:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var o,i,r,n,c,d,address,_,f,h,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.consumed){t.next=24;break}return t.next=3,e.$model.requerants().getList();case 3:o=t.sent,i=0;case 5:if(!(i<o.length)){t.next=24;break}return r=o[i],t.next=9,e.$model.request_register().getRequests(r.address);case 9:n=t.sent,c=n.accepted,d=0;case 12:if(!(d<c.length)){t.next=21;break}return address=c[d],t.next=16,e.$model.request_register().readRequest(address);case 16:for(_=t.sent,f=0;f<_.couples.length;f++)h=_.couples[f],e.accepteds[h.parcelle.id]||(e.accepteds[h.parcelle.id]={}),e.accepteds[h.parcelle.id][h.pool.pool]||(e.accepteds[h.parcelle.id][h.pool.pool]={consumedDab:0}),e.accepteds[h.parcelle.id][h.pool.pool].consumedDab+=Number(h.dab);case 18:d++,t.next=12;break;case 21:i++,t.next=5;break;case 24:return t.next=26,l.a.read(e.ipfs);case 26:v=t.sent,v=JSON.parse(v),e.model=v,e.parcelles=v.data.parcelles,e.pools=v.data.pools,e.parcelle_pool_dabs=v.data.parcelle_pool_dabs;case 32:case"end":return t.stop()}}),t)})))()},methods:{getLocalParcellePoolDABs:function(e,t){var o=0;return this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={}&&this.parcelle_pool_dabs[e]&&this.parcelle_pool_dabs[e][t]&&(o=Number(this.parcelle_pool_dabs[e][t])),o},getConsumedParcellePoolDABs:function(e,t){return this.accepteds[e]&&this.accepteds[e][t]?this.accepteds[e][t].consumedDab:0},getLocalSurfaceTotal:function(){var e=0;return this.parcelles.forEach((function(t){e+=Number(t.surface)})),e},getLocalDABs:function(){var e=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={})for(var t in this.parcelle_pool_dabs)for(var o in this.parcelle_pool_dabs[t])e+=Number(this.parcelle_pool_dabs[t][o]);return e},getLocalPoolDABs:function(e){var t=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={})for(var o in this.parcelle_pool_dabs)this.parcelle_pool_dabs[o][e]&&(t+=Number(this.parcelle_pool_dabs[o][e]));return t},getLocalParcelleDABs:function(e){var t=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={}&&this.parcelle_pool_dabs[e])for(var o in this.parcelle_pool_dabs[e])t+=Number(this.parcelle_pool_dabs[e][o]);return t},selectIt:function(){this.$emit("select")},copyIt:function(){this.$emit("copy")}}},c=(o(1483),o(84)),component=Object(c.a)(n,(function(){var e=this,t=e._self._c;return t("section",{staticClass:"dabTable"},[e.consumed&&!e.model?[e.model?e._e():t("p",[e._v("Veuillez patientez, calcul du tableau de consommation en cours...")])]:e._e(),e._v(" "),!e.consumed||e.model?[e.model?e._e():t("p",[e._v("Chargement...")]),e._v(" "),!e.model||e.show||e.readOnly?e._e():t("button",{on:{click:function(t){e.show=!0}}},[t("i",{staticClass:"fa fa-eye"}),e._v(" Afficher")]),e._v(" "),e.model&&e.show&&!e.readOnly?t("button",{on:{click:function(t){e.show=!1}}},[t("i",{staticClass:"fa fa-eye-slash"}),e._v(" Cacher  ")]):e._e(),e._v(" "),e.model&&(e.show||e.readOnly)?t("table",[t("tr",[t("th",{attrs:{colspan:"3"}},[e._v("Tableau de répartition des droits à bâtir")]),e._v(" "),t("th",{attrs:{colspan:e.pools.length}},[e._v("Localisation des droits à bâtir")])]),e._v(" "),t("tr",[t("th",{attrs:{rowspan:"2"}},[e._v("Parcelle N°")]),e._v(" "),e._m(0),e._v(" "),t("th",{attrs:{rowspan:"2"}},[e._v("DAB")]),e._v(" "),e._l(e.pools,(function(o,r){return t("th",{attrs:{width:100/(3+e.pools.length)+"%"}},[e._v("BAT")])}))],2),e._v(" "),t("tr",e._l(e.pools,(function(o,r){return t("th",[e._v(e._s(o.pool))])})),0),e._v(" "),e._l(e.parcelles,(function(o,r){return t("tr",[o?t("th",[e._v(e._s(o.id))]):e._e(),e._v(" "),o?t("td",[e._v(e._s(o.surface))]):e._e(),e._v(" "),o?t("th",[e._v(e._s(e.getLocalParcelleDABs(o.uuid)))]):e._e(),e._v(" "),e._l(e.pools,(function(r,l){return t("td",[e.consumed?e._e():[e._v("\n            "+e._s(e.getLocalParcellePoolDABs(o.uuid,r.uuid))+"\n          ")],e._v(" "),e.consumed?[t("strong",[e._v(e._s(e.getConsumedParcellePoolDABs(o.id,r.pool)))]),e._v(" / "+e._s(e.getLocalParcellePoolDABs(o.uuid,r.uuid))+"\n          ")]:e._e()],2)}))],2)})),e._v(" "),t("tr",[t("th",[e._v("TOTAL")]),e._v(" "),t("th",[e._v(e._s(e.getLocalSurfaceTotal()))]),e._v(" "),t("th",[e._v(e._s(e.getLocalDABs()))]),e._v(" "),e._l(e.pools,(function(o,r){return t("th",[e._v(e._s(e.getLocalPoolDABs(o.uuid)))])}))],2)],2):e._e(),e._v(" "),e.model&&e.show&&!e.readOnly?t("button",{on:{click:function(t){return e.copyIt()}}},[t("i",{staticClass:"fa fa-arrow-left"}),e._v(" Éditer le tableau de cette proposition")]):e._e(),e._v(" "),e.model&&e.show&&!e.readOnly?t("button",{on:{click:function(t){return e.selectIt()}}},[t("i",{staticClass:"fa fa-arrow-right"}),e._v(" Voter pour cette proposition")]):e._e()]:e._e()],2)}),[function(){var e=this,t=e._self._c;return t("th",{attrs:{rowspan:"2"}},[e._v("Surface"),t("br"),e._v("Parcelle"),t("br"),e._v("en ZD3")])}],!1,null,null,null);t.a=component.exports},1487:function(e,t,o){var content=o(1495);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(117).default)("3c5bd398",content,!0,{sourceMap:!1})},1494:function(e,t,o){"use strict";o(1487)},1495:function(e,t,o){var r=o(116)((function(i){return i[1]}));r.push([e.i,".proposalList ul>li{margin-bottom:2em}",""]),r.locals={},e.exports=r},1498:function(e,t,o){"use strict";o.r(t);var r=o(2),l=(o(25),o(1485)),n=o(17),c={components:{dabTable:l.a},data:function(){return{DABModel:null}},computed:{proposalList:function(){return this.DABModel.proposalIds()}},created:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.DABModel=e.$model.dab();case 1:case"end":return t.stop()}}),t)})))()},methods:{select:function(e){var t=this;return!!confirm("Êtes-vous sûr d'accepter ce tableau comme nouveau tableau de référence ? Les autres propositions ne seront plus accessible.")&&(n.a.$on("proposal-accepted",(function(){t.$router.push("table")})),this.DABModel.acceptProposal(e))},copy:function(e){var t=this;return!((!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&!confirm("Êtes-vous sûr de vouloir remplacer votre tableau local par ce tableau-ci ? Vos modifications locales seront écrasées."))&&this.DABModel.copyProposal(e).then((function(e){return t.$router.push("edit"),!0}))}}},d=c,_=(o(1494),o(84)),f={layout:"default",components:{proposalList:Object(_.a)(d,(function(){var e=this,t=e._self._c;return t("section",{staticClass:"proposalList"},[e.proposalList.length>1?t("p",[e._v("\n  La liste est ordonnée par date de proposition (la première proposition en premier)")]):e._e(),e._v(" "),t("ul",e._l(e.proposalList,(function(o,r){return t("li",[e._v("\n      Proposition "+e._s(o)+"\n      "),t("dabTable",{attrs:{ipfs:o},on:{select:function(t){return e.select(o)},copy:function(t){return e.copy(o)}}})],1)})),0)])}),[],!1,null,null,null).exports}},h=Object(_.a)(f,(function(){var e=this,t=e._self._c;return e.$store.state.model.initialised?t("div",{staticClass:"wrapper"},[t("h1",[e._v("Tableau initial des DABs partagé")]),e._v(" "),t("h2",[e._v("Liste des propositions")]),e._v(" "),t("proposalList")],1):e._e()}),[],!1,null,null,null);t.default=h.exports}}]);