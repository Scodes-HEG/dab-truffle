(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1482:function(e,t,o){var content=o(1484);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(117).default)("d4422b1c",content,!0,{sourceMap:!1})},1483:function(e,t,o){"use strict";o(1482)},1484:function(e,t,o){var l=o(116)((function(i){return i[1]}));l.push([e.i,"table{border-collapse:collapse;width:100%}tr:nth-of-type(odd){background:#eee}th{background:#333;color:#fff;font-weight:700}td,th{border:1px solid #ccc;padding:6px;text-align:left}input[type=number],input[type=string],input[type=text]{background-color:#f6f7e8}table input[type=number]{height:1.5em;margin:0;padding:1px;width:4em}",""]),l.locals={},e.exports=l},1485:function(e,t,o){"use strict";var l=o(2),r=(o(25),o(367),o(48),o(23),o(64),o(34)),n={props:{ipfs:null,readOnly:!1,consumed:!1},data:function(){return{show:!1,model:null,parcelles:[],pools:[],parcelle_pool_dabs:{},accepteds:{}}},created:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var o,i,l,n,c,d,address,_,h,f,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.consumed){t.next=24;break}return t.next=3,e.$model.requerants().getList();case 3:o=t.sent,i=0;case 5:if(!(i<o.length)){t.next=24;break}return l=o[i],t.next=9,e.$model.request_register().getRequests(l.address);case 9:n=t.sent,c=n.accepted,d=0;case 12:if(!(d<c.length)){t.next=21;break}return address=c[d],t.next=16,e.$model.request_register().readRequest(address);case 16:for(_=t.sent,h=0;h<_.couples.length;h++)f=_.couples[h],e.accepteds[f.parcelle.id]||(e.accepteds[f.parcelle.id]={}),e.accepteds[f.parcelle.id][f.pool.pool]||(e.accepteds[f.parcelle.id][f.pool.pool]={consumedDab:0}),e.accepteds[f.parcelle.id][f.pool.pool].consumedDab+=Number(f.dab);case 18:d++,t.next=12;break;case 21:i++,t.next=5;break;case 24:return t.next=26,r.a.read(e.ipfs);case 26:v=t.sent,v=JSON.parse(v),e.model=v,e.parcelles=v.data.parcelles,e.pools=v.data.pools,e.parcelle_pool_dabs=v.data.parcelle_pool_dabs;case 32:case"end":return t.stop()}}),t)})))()},methods:{getLocalParcellePoolDABs:function(e,t){var o=0;return this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={}&&this.parcelle_pool_dabs[e]&&this.parcelle_pool_dabs[e][t]&&(o=Number(this.parcelle_pool_dabs[e][t])),o},getConsumedParcellePoolDABs:function(e,t){return this.accepteds[e]&&this.accepteds[e][t]?this.accepteds[e][t].consumedDab:0},getLocalSurfaceTotal:function(){var e=0;return this.parcelles.forEach((function(t){e+=Number(t.surface)})),e},getLocalDABs:function(){var e=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={})for(var t in this.parcelle_pool_dabs)for(var o in this.parcelle_pool_dabs[t])e+=Number(this.parcelle_pool_dabs[t][o]);return e},getLocalPoolDABs:function(e){var t=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={})for(var o in this.parcelle_pool_dabs)this.parcelle_pool_dabs[o][e]&&(t+=Number(this.parcelle_pool_dabs[o][e]));return t},getLocalParcelleDABs:function(e){var t=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={}&&this.parcelle_pool_dabs[e])for(var o in this.parcelle_pool_dabs[e])t+=Number(this.parcelle_pool_dabs[e][o]);return t},selectIt:function(){this.$emit("select")},copyIt:function(){this.$emit("copy")}}},c=(o(1483),o(84)),component=Object(c.a)(n,(function(){var e=this,t=e._self._c;return t("section",{staticClass:"dabTable"},[e.consumed&&!e.model?[e.model?e._e():t("p",[e._v("Veuillez patientez, calcul du tableau de consommation en cours...")])]:e._e(),e._v(" "),!e.consumed||e.model?[e.model?e._e():t("p",[e._v("Chargement...")]),e._v(" "),!e.model||e.show||e.readOnly?e._e():t("button",{on:{click:function(t){e.show=!0}}},[t("i",{staticClass:"fa fa-eye"}),e._v(" Afficher")]),e._v(" "),e.model&&e.show&&!e.readOnly?t("button",{on:{click:function(t){e.show=!1}}},[t("i",{staticClass:"fa fa-eye-slash"}),e._v(" Cacher  ")]):e._e(),e._v(" "),e.model&&(e.show||e.readOnly)?t("table",[t("tr",[t("th",{attrs:{colspan:"3"}},[e._v("Tableau de répartition des droits à bâtir")]),e._v(" "),t("th",{attrs:{colspan:e.pools.length}},[e._v("Localisation des droits à bâtir")])]),e._v(" "),t("tr",[t("th",{attrs:{rowspan:"2"}},[e._v("Parcelle N°")]),e._v(" "),e._m(0),e._v(" "),t("th",{attrs:{rowspan:"2"}},[e._v("DAB")]),e._v(" "),e._l(e.pools,(function(o,l){return t("th",{attrs:{width:100/(3+e.pools.length)+"%"}},[e._v("BAT")])}))],2),e._v(" "),t("tr",e._l(e.pools,(function(o,l){return t("th",[e._v(e._s(o.pool))])})),0),e._v(" "),e._l(e.parcelles,(function(o,l){return t("tr",[o?t("th",[e._v(e._s(o.id))]):e._e(),e._v(" "),o?t("td",[e._v(e._s(o.surface))]):e._e(),e._v(" "),o?t("th",[e._v(e._s(e.getLocalParcelleDABs(o.uuid)))]):e._e(),e._v(" "),e._l(e.pools,(function(l,r){return t("td",[e.consumed?e._e():[e._v("\n            "+e._s(e.getLocalParcellePoolDABs(o.uuid,l.uuid))+"\n          ")],e._v(" "),e.consumed?[t("strong",[e._v(e._s(e.getConsumedParcellePoolDABs(o.id,l.pool)))]),e._v(" / "+e._s(e.getLocalParcellePoolDABs(o.uuid,l.uuid))+"\n          ")]:e._e()],2)}))],2)})),e._v(" "),t("tr",[t("th",[e._v("TOTAL")]),e._v(" "),t("th",[e._v(e._s(e.getLocalSurfaceTotal()))]),e._v(" "),t("th",[e._v(e._s(e.getLocalDABs()))]),e._v(" "),e._l(e.pools,(function(o,l){return t("th",[e._v(e._s(e.getLocalPoolDABs(o.uuid)))])}))],2)],2):e._e(),e._v(" "),e.model&&e.show&&!e.readOnly?t("button",{on:{click:function(t){return e.copyIt()}}},[t("i",{staticClass:"fa fa-arrow-left"}),e._v(" Éditer le tableau de cette proposition")]):e._e(),e._v(" "),e.model&&e.show&&!e.readOnly?t("button",{on:{click:function(t){return e.selectIt()}}},[t("i",{staticClass:"fa fa-arrow-right"}),e._v(" Voter pour cette proposition")]):e._e()]:e._e()],2)}),[function(){var e=this,t=e._self._c;return t("th",{attrs:{rowspan:"2"}},[e._v("Surface"),t("br"),e._v("Parcelle"),t("br"),e._v("en ZD3")])}],!1,null,null,null);t.a=component.exports},1502:function(e,t,o){"use strict";o.r(t);var l={layout:"default",components:{dabTable:o(1485).a}},r=o(84),component=Object(r.a)(l,(function(){var e=this,t=e._self._c;return e.$store.state.model.initialised?t("div",{staticClass:"wrapper"},[e.$store.state.model.dab.hash?[t("h1",[e._v("Tableau de consommation des DABs")]),e._v(" "),t("dabTable",{attrs:{ipfs:e.$store.state.model.dab.hash,readOnly:!0,consumed:!0}})]:[t("h2",[e._v("Pas de tableau de consomation:")]),e._v(" "),t("p",[e._v("Il n'y a pas encore de tableau initial")])]],2):e._e()}),[],!1,null,null,null);t.default=component.exports}}]);