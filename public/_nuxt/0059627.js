(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{1686:function(e,t,l){var content=l(1688);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,l(121).default)("36352c98",content,!0,{sourceMap:!1})},1687:function(e,t,l){"use strict";var o=l(1686);l.n(o).a},1688:function(e,t,l){(t=l(120)(!1)).push([e.i,"table{width:100%;border-collapse:collapse}tr:nth-of-type(odd){background:#eee}th{background:#333;color:#fff;font-weight:700}td,th{padding:6px;border:1px solid #ccc;text-align:left}input[type=number],input[type=string],input[type=text]{background-color:#f6f7e8}table input[type=number]{width:4em;margin:0;padding:1px;height:1.5em}",""]),e.exports=t},1689:function(e,t,l){"use strict";l(86),l(691),l(87),l(25);var o=l(3),r=l(36),n={props:{ipfs:null,readOnly:!1,consumed:!1},data:function(){return{show:!1,model:null,parcelles:[],pools:[],parcelle_pool_dabs:{},accepteds:{}}},created:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var l,i,o,n,c,_,address,d,h,f,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.consumed){t.next=24;break}return t.next=3,e.$model.requerants().getList();case 3:l=t.sent,i=0;case 5:if(!(i<l.length)){t.next=24;break}return o=l[i],t.next=9,e.$model.request_register().getRequests(o.address);case 9:n=t.sent,c=n.accepted,_=0;case 12:if(!(_<c.length)){t.next=21;break}return address=c[_],t.next=16,e.$model.request_register().readRequest(address);case 16:for(d=t.sent,h=0;h<d.couples.length;h++)f=d.couples[h],e.accepteds[f.parcelle.id]||(e.accepteds[f.parcelle.id]={}),e.accepteds[f.parcelle.id][f.pool.pool]||(e.accepteds[f.parcelle.id][f.pool.pool]={consumedDab:0}),e.accepteds[f.parcelle.id][f.pool.pool].consumedDab+=Number(f.dab);case 18:_++,t.next=12;break;case 21:i++,t.next=5;break;case 24:return t.next=26,r.a.read(e.ipfs);case 26:v=t.sent,v=JSON.parse(v),e.model=v,e.parcelles=v.data.parcelles,e.pools=v.data.pools,e.parcelle_pool_dabs=v.data.parcelle_pool_dabs;case 32:case"end":return t.stop()}}),t)})))()},methods:{getLocalParcellePoolDABs:function(e,t){var l=0;return this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={}&&this.parcelle_pool_dabs[e]&&this.parcelle_pool_dabs[e][t]&&(l=Number(this.parcelle_pool_dabs[e][t])),l},getConsumedParcellePoolDABs:function(e,t){return this.accepteds[e]&&this.accepteds[e][t]?this.accepteds[e][t].consumedDab:0},getLocalSurfaceTotal:function(){var e=0;return this.parcelles.forEach((function(t){e+=Number(t.surface)})),e},getLocalDABs:function(){var e=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={})for(var t in this.parcelle_pool_dabs)for(var l in this.parcelle_pool_dabs[t])e+=Number(this.parcelle_pool_dabs[t][l]);return e},getLocalPoolDABs:function(e){var t=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={})for(var l in this.parcelle_pool_dabs)this.parcelle_pool_dabs[l][e]&&(t+=Number(this.parcelle_pool_dabs[l][e]));return t},getLocalParcelleDABs:function(e){var t=0;if(this.parcelle_pool_dabs&&this.parcelle_pool_dabs!={}&&this.parcelle_pool_dabs[e])for(var l in this.parcelle_pool_dabs[e])t+=Number(this.parcelle_pool_dabs[e][l]);return t},selectIt:function(){this.$emit("select")},copyIt:function(){this.$emit("copy")}}},c=(l(1687),l(85)),component=Object(c.a)(n,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("section",{staticClass:"dabTable"},[e.consumed&&!e.model?[e.model?e._e():l("p",[e._v("Veuillez patientez, calcul du tableau de consommation en cours...")])]:e._e(),e._v(" "),!e.consumed||e.model?[e.model?e._e():l("p",[e._v("Chargement...")]),e._v(" "),!e.model||e.show||e.readOnly?e._e():l("button",{on:{click:function(t){e.show=!0}}},[l("i",{staticClass:"fa fa-eye"}),e._v(" Afficher")]),e._v(" "),e.model&&e.show&&!e.readOnly?l("button",{on:{click:function(t){e.show=!1}}},[l("i",{staticClass:"fa fa-eye-slash"}),e._v(" Cacher  ")]):e._e(),e._v(" "),e.model&&(e.show||e.readOnly)?l("table",[l("tr",[l("th",{attrs:{colspan:"3"}},[e._v("Tableau de répartition des droits à bâtir")]),e._v(" "),l("th",{attrs:{colspan:e.pools.length}},[e._v("Localisation des droits à bâtir")])]),e._v(" "),l("tr",[l("th",{attrs:{rowspan:"2"}},[e._v("Parcelle N°")]),e._v(" "),e._m(0),e._v(" "),l("th",{attrs:{rowspan:"2"}},[e._v("DAB")]),e._v(" "),e._l(e.pools,(function(t,o){return l("th",{attrs:{width:100/(3+e.pools.length)+"%"}},[e._v("BAT")])}))],2),e._v(" "),l("tr",e._l(e.pools,(function(t,o){return l("th",[e._v(e._s(t.pool))])})),0),e._v(" "),e._l(e.parcelles,(function(t,o){return l("tr",[t?l("th",[e._v(e._s(t.id))]):e._e(),e._v(" "),t?l("td",[e._v(e._s(t.surface))]):e._e(),e._v(" "),t?l("th",[e._v(e._s(e.getLocalParcelleDABs(t.uuid)))]):e._e(),e._v(" "),e._l(e.pools,(function(o,r){return l("td",[e.consumed?e._e():[e._v("\n            "+e._s(e.getLocalParcellePoolDABs(t.uuid,o.uuid))+"\n          ")],e._v(" "),e.consumed?[l("strong",[e._v(e._s(e.getConsumedParcellePoolDABs(t.id,o.pool)))]),e._v(" / "+e._s(e.getLocalParcellePoolDABs(t.uuid,o.uuid))+"\n          ")]:e._e()],2)}))],2)})),e._v(" "),l("tr",[l("th",[e._v("TOTAL")]),e._v(" "),l("th",[e._v(e._s(e.getLocalSurfaceTotal()))]),e._v(" "),l("th",[e._v(e._s(e.getLocalDABs()))]),e._v(" "),e._l(e.pools,(function(t,o){return l("th",[e._v(e._s(e.getLocalPoolDABs(t.uuid)))])}))],2)],2):e._e(),e._v(" "),e.model&&e.show&&!e.readOnly?l("button",{on:{click:function(t){return e.copyIt()}}},[l("i",{staticClass:"fa fa-arrow-left"}),e._v(" Éditer le tableau de cette proposition")]):e._e(),e._v(" "),e.model&&e.show&&!e.readOnly?l("button",{on:{click:function(t){return e.selectIt()}}},[l("i",{staticClass:"fa fa-arrow-right"}),e._v(" Voter pour cette proposition")]):e._e()]:e._e()],2)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("th",{attrs:{rowspan:"2"}},[this._v("Surface"),t("br"),this._v("Parcelle"),t("br"),this._v("en ZD3")])}],!1,null,null,null);t.a=component.exports},1707:function(e,t,l){"use strict";l.r(t);var o={layout:"default",components:{dabTable:l(1689).a}},r=l(85),component=Object(r.a)(o,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return e.$store.state.model.initialised?l("div",{staticClass:"wrapper"},[l("h1",[e._v("Tableau initial des DABs partagé")]),e._v(" "),e.$store.state.model.dab.hash?[l("h2",[e._v("Tableau validé")]),e._v(" "),l("dabTable",{attrs:{ipfs:e.$store.state.model.dab.hash,readOnly:!0}})]:[l("h2",[e._v("Aucun Tableau validé pour le moment")])]],2):e._e()}),[],!1,null,null,null);t.default=component.exports}}]);