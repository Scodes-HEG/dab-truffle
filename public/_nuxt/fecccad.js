(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1690:function(e,t,l){var content=l(1698);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,l(121).default)("6b09f109",content,!0,{sourceMap:!1})},1697:function(e,t,l){"use strict";var o=l(1690);l.n(o).a},1698:function(e,t,l){(t=l(120)(!1)).push([e.i,".inline{display:inline-block!important}table{width:100%;border-collapse:collapse}tr:nth-of-type(odd){background:#eee}th{background:#333;color:#fff;font-weight:700}td,th{padding:6px;border:1px solid #ccc;text-align:left}input[type=number],input[type=string],input[type=text]{background-color:#f6f7e8}table input[type=number]{width:4em;margin:0;padding:1px;height:1.5em}.handle{cursor:move}aside#flyingMenu{position:fixed;top:2em;right:1em;display:flex;flex-direction:column}#flyingMenu>nav{background:rgba(209,240,210,.7);border-radius:1em;padding:.5em;margin-bottom:.5em;max-width:15em}#flyingMenu>nav>button{float:left}button.success{background-color:rgba(147,236,154,.7)}button.success:hover{background-color:#93ec9a}button.alert{background-color:hsla(4,70%,75%,.7)}button.alert:hover{background-color:#ec9993}",""]),e.exports=t},1701:function(e,t,l){"use strict";l.r(t);l(122),l(25);var o=l(3),r=l(1695),n=l.n(r),c=l(19),d={components:{draggable:n.a},data:function(){return{parcelles:[],pools:[],dabs:{},parcellesEditClick:!1,poolsEditClick:!1,dabsEditClick:!0,DABModel:null,isDiff:!1,isDiffParcelles:!1,isDiffPools:!1,isDiffInterval:null}},created:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.DABModel=e.$model.dab(),e.initLocal(),e.isDiffInterval||(e.isDiffInterval=setInterval((function(){e.isDiff=e.DABModel.isDiff(),e.isDiffParcelles=e.DABModel.isDiffParcelles(),e.isDiffPools=e.DABModel.isDiffPools()}),1e3));case 3:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.isDiffInterval&&clearInterval(this.isDiffInterval)},methods:{initLocal:function(){this.parcelles=this.DABModel.getLocalParcelles(),this.parcelles.length||(this.parcellesEditClick=!0),this.pools=this.DABModel.getLocalPools(),this.pools.length||(this.poolsEditClick=!0),this.parcelles.length||this.pools.length||(this.dabsEditClick=!1)},addParcelle:function(){this.DABModel.addNewLocalParcelle(),this.parcelles=this.DABModel.getLocalParcelles()},removeParcelle:function(e){this.DABModel.removeParcelle(this.parcelles[e].uuid),this.parcelles=this.DABModel.getLocalParcelles()},saveParcelles:function(){this.DABModel.saveLocalParcelles(this.parcelles)},addPool:function(){this.DABModel.addNewLocalPool(),this.pools=this.DABModel.getLocalPools()},removePool:function(e){this.DABModel.removePool(this.pools[e].uuid),this.pools=this.DABModel.getLocalPools()},savePools:function(){this.DABModel.saveLocalPools(this.pools)},saveDABs:function(e,t,l){this.DABModel.saveLocalParcellePoolDABs(e,t,l.target.value)},proposeLocal:function(){var e=this;c.a.$on("proposal-created",(function(){e.$router.push("proposals")})),this.DABModel.proposeLocal()},pullRemote:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(confirm("Êtes-vous sûr de vouloir revenir au tableau de référence ? Vos modifications seront perdues")){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,e.DABModel.pullRemote();case 4:e.initLocal();case 5:case"end":return t.stop()}}),t)})))()},pullRemoteParcelles:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(confirm("Êtes-vous sûr de vouloir revenir aux parcelles du tableau de référence ? Vos modifications seront perdues")){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,e.DABModel.pullRemoteParcelles();case 4:e.initLocal();case 5:case"end":return t.stop()}}),t)})))()},pullRemotePools:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(confirm("Êtes-vous sûr de vouloir revenir aux colonnes du tableau de référence ? Vos modifications seront perdues")){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,e.DABModel.pullRemotePools();case 4:e.initLocal();case 5:case"end":return t.stop()}}),t)})))()}}},v=(l(1697),l(85)),f={layout:"default",components:{editTable:Object(v.a)(d,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("section",{staticClass:"editTable"},[l("h3",[e._v("Liste des parcelles")]),e._v(" "),e.parcellesEditClick?l("a",{on:{click:function(t){e.parcellesEditClick=!e.parcellesEditClick}}},[e._v("Cacher")]):e._e(),e._v(" "),e.parcellesEditClick?e._e():l("a",{on:{click:function(t){e.parcellesEditClick=!e.parcellesEditClick}}},[e._v("Montrer")]),e._v(" "),e.parcellesEditClick?l("div",{staticClass:"editWrapper"},[l("draggable",{on:{end:function(t){return e.saveParcelles()}},model:{value:e.parcelles,callback:function(t){e.parcelles=t},expression:"parcelles"}},e._l(e.parcelles,(function(t,o){return l("div",[l("i",{staticClass:"fa fa-arrows handle"}),e._v(" "),0==o?[l("label",{staticClass:"inline"},[e._v("Identifiant"),l("br"),e._v(" "),l("input",{directives:[{name:"model",rawName:"v-model",value:e.parcelles[o].id,expression:"parcelles[index].id"}],attrs:{type:"string"},domProps:{value:e.parcelles[o].id},on:{change:function(t){return e.saveParcelles()},input:function(t){t.target.composing||e.$set(e.parcelles[o],"id",t.target.value)}}})]),e._v(" "),l("label",{staticClass:"inline"},[e._v("Surface"),l("br"),e._v(" "),l("input",{directives:[{name:"model",rawName:"v-model",value:e.parcelles[o].surface,expression:"parcelles[index].surface"}],staticClass:"inline",attrs:{type:"number"},domProps:{value:e.parcelles[o].surface},on:{change:function(t){return e.saveParcelles()},input:function(t){t.target.composing||e.$set(e.parcelles[o],"surface",t.target.value)}}})]),e._v(" "),l("button",{staticClass:"commit",on:{click:function(t){return e.removeParcelle(o)}}},[e._v("- Supprimer")])]:e._e(),e._v(" "),0!=o?[l("input",{directives:[{name:"model",rawName:"v-model",value:e.parcelles[o].id,expression:"parcelles[index].id"}],staticClass:"inline",attrs:{type:"string"},domProps:{value:e.parcelles[o].id},on:{change:function(t){return e.saveParcelles()},input:function(t){t.target.composing||e.$set(e.parcelles[o],"id",t.target.value)}}}),e._v(" "),l("input",{directives:[{name:"model",rawName:"v-model",value:e.parcelles[o].surface,expression:"parcelles[index].surface"}],staticClass:"inline",attrs:{type:"number"},domProps:{value:e.parcelles[o].surface},on:{change:function(t){return e.saveParcelles()},input:function(t){t.target.composing||e.$set(e.parcelles[o],"surface",t.target.value)}}}),e._v(" "),l("button",{staticClass:"commit",on:{click:function(t){return e.removeParcelle(o)}}},[e._v("- Supprimer")])]:e._e()],2)})),0),e._v(" "),l("button",{staticClass:"commit",on:{click:function(t){return e.addParcelle()}}},[e._v("+ Ajouter une parcelle")])],1):e._e(),e._v(" "),l("br"),e._v(" "),l("hr"),e._v(" "),l("h3",[e._v("Liste des pools de batiments")]),e._v(" "),e.poolsEditClick?l("a",{on:{click:function(t){e.poolsEditClick=!e.poolsEditClick}}},[e._v("Cacher")]):e._e(),e._v(" "),e.poolsEditClick?e._e():l("a",{on:{click:function(t){e.poolsEditClick=!e.poolsEditClick}}},[e._v("Montrer")]),e._v(" "),e.poolsEditClick?l("div",{staticClass:"editWrapper"},[l("draggable",{on:{end:function(t){return e.savePools()}},model:{value:e.pools,callback:function(t){e.pools=t},expression:"pools"}},e._l(e.pools,(function(t,o){return l("div",[l("i",{staticClass:"fa fa-arrows handle"}),e._v(" "),0==o?[l("label",{staticClass:"inline"},[e._v("Bâtiments du pool"),l("br"),e._v("(séparés par une virgule)"),l("br"),e._v(" "),l("input",{directives:[{name:"model",rawName:"v-model",value:e.pools[o].pool,expression:"pools[index].pool"}],staticClass:"inline",attrs:{type:"string"},domProps:{value:e.pools[o].pool},on:{change:function(t){return e.savePools()},input:function(t){t.target.composing||e.$set(e.pools[o],"pool",t.target.value)}}})]),e._v(" "),l("button",{staticClass:"commit",on:{click:function(t){return e.removePool(o)}}},[e._v("- Supprimer")])]:e._e(),e._v(" "),0!=o?[l("input",{directives:[{name:"model",rawName:"v-model",value:e.pools[o].pool,expression:"pools[index].pool"}],staticClass:"inline",attrs:{type:"string"},domProps:{value:e.pools[o].pool},on:{change:function(t){return e.savePools()},input:function(t){t.target.composing||e.$set(e.pools[o],"pool",t.target.value)}}}),e._v(" "),l("button",{staticClass:"commit",on:{click:function(t){return e.removePool(o)}}},[e._v("- Supprimer")])]:e._e()],2)})),0),e._v(" "),l("button",{staticClass:"commit",on:{click:function(t){return e.addPool()}}},[e._v("+ Ajouter un pool de bâtiment(s)")])],1):e._e(),e._v(" "),l("br"),e._v(" "),l("hr"),e._v(" "),l("h3",[e._v("Tableau initial des droits")]),e._v(" "),e.dabsEditClick?l("a",{on:{click:function(t){e.dabsEditClick=!e.dabsEditClick}}},[e._v("Cacher")]):e._e(),e._v(" "),e.dabsEditClick?e._e():l("a",{on:{click:function(t){e.dabsEditClick=!e.dabsEditClick}}},[e._v("Montrer")]),e._v(" "),e.dabsEditClick?l("table",[l("tr",[l("th",{attrs:{colspan:"3"}},[e._v("Tableau de répartition des droits à bâtir")]),e._v(" "),l("th",{attrs:{colspan:e.pools.length}},[e._v("Localisation des droits à bâtir")])]),e._v(" "),l("tr",[l("th",{attrs:{rowspan:"2"}},[e._v("Parcelle N°")]),e._v(" "),e._m(0),e._v(" "),l("th",{attrs:{rowspan:"2"}},[e._v("DAB")]),e._v(" "),e._l(e.pools,(function(t,o){return l("th",{attrs:{width:100/(3+e.pools.length)+"%"}},[e._v("BAT")])}))],2),e._v(" "),l("draggable",{attrs:{tag:"tr"},on:{end:function(t){return e.savePools()}},model:{value:e.pools,callback:function(t){e.pools=t},expression:"pools"}},e._l(e.pools,(function(t,o){return l("th",{staticClass:"handle"},[e._v(e._s(t.pool))])})),0),e._v(" "),e._l(e.parcelles,(function(t,o){return l("tr",{staticClass:"draggableParcelle"},[t?l("th",[e._v(e._s(t.id))]):e._e(),e._v(" "),t?l("td",[e._v(e._s(t.surface))]):e._e(),e._v(" "),t?l("th",[e._v(e._s(e.DABModel.getLocalParcelleDABs(t.uuid)))]):e._e(),e._v(" "),e._l(e.pools,(function(o,r){return l("td",[t?l("input",{attrs:{type:"number",min:"0"},domProps:{value:e.DABModel.getLocalParcellePoolDABs(t.uuid,o.uuid)},on:{change:function(l){return e.saveDABs(t.uuid,o.uuid,l)}}}):e._e()])}))],2)})),e._v(" "),l("tr",[l("th",[e._v("TOTAL")]),e._v(" "),l("th",[e._v(e._s(e.DABModel.getLocalSurfaceTotal()))]),e._v(" "),l("th",[e._v(e._s(e.DABModel.getLocalDABs()))]),e._v(" "),e._l(e.pools,(function(t,o){return l("th",[e._v(e._s(e.DABModel.getLocalPoolDABs(t.uuid)))])}))],2)],2):e._e(),e._v(" "),e.isDiff||e.isDiffParcelles||e.isDiffPools?l("aside",{attrs:{id:"flyingMenu"}},[l("nav",[l("p",[e._v("Votre tableau est local est différent du tableau de référence")]),e._v(" "),l("button",{staticClass:"success",on:{click:function(t){return e.proposeLocal()}}},[l("i",{staticClass:"fa fa-arrow-right"}),e._v(" Proposer comme nouveau tableau de référence")]),e._v(" "),e.isDiff?l("button",{staticClass:"alert",on:{click:function(t){return e.pullRemote()}}},[l("i",{staticClass:"fa fa-times"}),e._v(" Revenir au tableau de référence")]):e._e(),e._v(" "),!e.isDiff&&e.isDiffParcelles?l("button",{staticClass:"alert",on:{click:function(t){return e.pullRemoteParcelles()}}},[l("i",{staticClass:"fa fa-times"}),e._v(" Revenir aux parcelles du tableau de référence")]):e._e(),e._v(" "),!e.isDiff&&e.isDiffPools?l("button",{staticClass:"alert",on:{click:function(t){return e.pullRemotePools()}}},[l("i",{staticClass:"fa fa-times"}),e._v(" Revenir aux pools de bâtiments du tableau de référence")]):e._e()])]):e._e()])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("th",{attrs:{rowspan:"2"}},[this._v("Surface"),t("br"),this._v("Parcelle"),t("br"),this._v("en ZD3")])}],!1,null,null,null).exports}},_=Object(v.a)(f,(function(){var e=this.$createElement,t=this._self._c||e;return this.$store.state.model.initialised?t("div",{staticClass:"wrapper"},[t("h1",[this._v("Tableau initial des DABs partagé")]),this._v(" "),t("h2",[this._v("Édition du tableau local")]),this._v(" "),t("editTable")],1):this._e()}),[],!1,null,null,null);t.default=_.exports}}]);